{"cells":[{"cell_type":"markdown","source":["# Задание:\n","### Используйте ниже приведенные ссылки на PDF файлы вакансии и резюме на позицию HR Директора.\n","### 1) Сформируйте 10 \"Ключевых требований к кандидату\" на основании вакансии для последующего анализа (нужно сформировать промпты, с указанием вакансии, отправить запрос к OpenAI вывести и сохранить ответ).\n","### 2) На основании сгенерированных \"Ключевых требований к кандидату\", текста вакансии и текста резюме Критично оцените, насколько кандидат подходит на указанную вакансию (нужно сформировать промпты, с указанием вакансии, резюме и Ключевых требовании к вакансии, отправить запрос к OpenAI и вывести ответ)."],"metadata":{"id":"78SM20xTyKlL"}},{"cell_type":"code","source":["#@title Ссылки на файлы вакансии и резюме на позицию HR Директора\n","\n","# Файл резюме\n","resume_link = 'https://drive.google.com/uc?export=download&id=1gmYfC_W2F-fN4hYtSsqof4WyCwgLf55w'\n","resume_link_yandex = 'https://disk.yandex.ru/i/ULV_Onsdrx7zrw'\n","\n","# Файл вакансии\n","vacancy_link = 'https://drive.google.com/uc?export=download&id=1aY5pH-VBuSvYuBFZAzO1-xsFN7tGLDKs'\n","vacancy_link_yandex = 'https://disk.yandex.ru/i/Lg7ZhWiutBVpXg'"],"metadata":{"id":"Dk1Y7N_Mo1Tv","executionInfo":{"status":"ok","timestamp":1760453870249,"user_tz":-180,"elapsed":103,"user":{"displayName":"летучая мыш нет","userId":"15606522630716566801"}}},"execution_count":69,"outputs":[]},{"cell_type":"code","source":["#@title Установка необходимых библиотек\n","!pip install -q openai langchain langchain_community \\\n","langchain_openai langchain_core faiss-cpu \\\n","rarfile PyPDF2 pydub==0.25.1 pdfplumber"],"metadata":{"id":"KZ2vIXyYi-Es"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["#@title Импорт библиотек, активация ключей, папки, глобальные переменные\n","\n","from langchain.text_splitter import MarkdownHeaderTextSplitter\n","from langchain_core.output_parsers import JsonOutputParser\n","from langchain_openai import OpenAIEmbeddings, ChatOpenAI\n","from langchain_core.pydantic_v1 import BaseModel, Field\n","from langchain_community.vectorstores import FAISS\n","from langchain.docstore.document import Document\n","from langchain.prompts import PromptTemplate\n","\n","from pydub import AudioSegment\n","from io import BytesIO\n","import aiohttp\n","from google.colab import userdata, drive\n","from PyPDF2 import PdfReader\n","from IPython.display import Audio, display, clear_output\n","from datetime import datetime\n","import requests\n","from urllib.parse import urlencode\n","import textwrap\n","import rarfile\n","import openai\n","import gdown\n","import json\n","import time\n","import os\n","import re\n","\n","# Подключаем ГуглДиск для работы с файлами\n","drive.mount('/content/drive')\n","# Формируем основной путь\n","path = '/content/drive/MyDrive/data/hr/'\n","# Формирование дополнительных путей\n","path_vacancies_pdf = f'{path}vacancies_pdf/'\n","path_vacancies_json = f'{path}vacancies_json/'\n","path_resumes_pdf = f'{path}resumes_pdf/'\n","path_resumes_json = f'{path}resumeses_json/'\n","path_db_faiss = f'{path}db_faiss/'\n","path_add_data = f'{path}add_data/'\n","\n","folders = [path, path_vacancies_pdf, path_vacancies_json, path_resumes_pdf,\n","           path_resumes_json, path_db_faiss, path_add_data ]\n","# Создание необходимых папок на ГуглДиске: '/data/hr/...'\n","for folder in folders:\n","    os.makedirs(folder, exist_ok=True)\n","\n","# Cоздание или очистка файла логов, если файл уже есть\n","open(os.path.join(path, '_log.txt'), 'w').close()"],"metadata":{"id":"L8c1fZubi9xv","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1760451902264,"user_tz":-180,"elapsed":1263,"user":{"displayName":"летучая мыш нет","userId":"15606522630716566801"}},"outputId":"399ed28e-1741-42c2-e54d-deda64c73ede"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["Drive already mounted at /content/drive; to attempt to forcibly remount, call drive.mount(\"/content/drive\", force_remount=True).\n"]}]},{"cell_type":"code","source":["# Получаем ключ API из переменной окружения\n","api_key = userdata.get('API_KEY')\n","\n","# Настройка базового URL\n","base_url = \"https://api.vsegpt.ru/v1\"\n","\n","# Настройка модели\n","model_config = {\n","    \"title\": \"o4-mini (vsegpt)\",\n","    \"provider\": \"openai\",\n","    \"model\": \"openai/o4-mini\",\n","    \"apiBase\": base_url,\n","    \"apiType\": \"openai\",\n","    \"apiKey\": api_key,  # Используем определенный api_key\n","    \"useLegacyCompletionsEndpoint\": False\n","}\n","\n","# Инициализация клиента OpenAI\n","client = openai.OpenAI(\n","    api_key=model_config[\"apiKey\"],\n","    base_url=model_config[\"apiBase\"],\n",")\n","\n","# Для использования TTS (text to speech) от Yandex https://auth.yandex.cloud/login\n","api_key_yandex = userdata.get('YANDEX_API_KEY')\n","folder_id_yandex = userdata.get('YANDEX_FOLDER_ID')\n","\n","# Cоздание или очистка файла логов, если файл уже есть\n","open(os.path.join(path, '_log.txt'), 'w').close()\n","clear_output() # очистка вывода"],"metadata":{"id":"_Ithmk7Y8KzW"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["#@title Функии\n","\n","# Функция для форматирования текста по абзацам\n","def format_text(text, width=120):\n","    # Разделяем текст на абзацы\n","    paragraphs = str(text).split('\\n')\n","    # Форматируем каждый абзац отдельно\n","    formatted_paragraphs = []\n","    for paragraph in paragraphs:\n","        # Используем textwrap.fill для форматирования абзаца, чтобы длина строки не превышала width\n","        formatted_paragraph = textwrap.fill(paragraph, width)\n","        formatted_paragraphs.append(formatted_paragraph)\n","    # Объединяем абзацы с символом новой строки\n","    return '\\n'.join(formatted_paragraphs)\n","\n","\n","# Функция записи логов в файл _log.txt\n","def add_log_file(text, title=''):\n","    time_now = f\"{datetime.now().strftime('%Y-%m-%d %H:%M')}\"\n","    with open(os.path.join(path, '_log.txt'), \"a\", encoding='utf-8') as file:\n","            file.write(f'\\n\\n{time_now}. {title}.\\n\\n{format_text(text)}')\n","\n","\n","# Функция подсчета количества используемых токенов и стоимость\n","# https://openai.com/pricing\n","def print_tokens_count_and_price(completion, model):\n","    if model == \"gpt-4o\":\n","        # gpt-4o - Input: $5 / 1M tokens - Output: $15 / 1M tokens\n","        input_price, output_price = 5, 15\n","    if model == \"gpt-4o-mini\":\n","        # gpt-4o-mini - Input: $0.15 / 1M tokens - Output: $0.60 / 1M tokens\n","        input_price, output_price = 0.15, 0.60\n","    price = input_price * completion.usage.prompt_tokens / 1e6 + \\\n","            output_price * completion.usage.completion_tokens / 1e6\n","    print(f'Tokens used: {completion.usage.prompt_tokens} + '\n","                       f'{completion.usage.completion_tokens} = '\n","                       f'{completion.usage.total_tokens}. '\n","                       f'*** {model} *** $ {round(price, 5)}')\n","\n","\n","# Функция генерации ответа от OpenAI\n","def generate_answer(prompt_system, prompt_user, prompt_assistant='', model='gpt-4o-mini', temp=0.1):\n","    messages = [\n","        {\"role\": \"system\", \"content\": prompt_system},\n","        {'role': 'assistant', 'content': prompt_assistant},\n","        {\"role\": \"user\", \"content\": prompt_user}\n","    ]\n","    response = openai.chat.completions.create(\n","        model=model,\n","        messages=messages,\n","        temperature=temp,\n","        # max_tokens=4000\n","    )\n","    # Вывод количества используемых токенов и стоимость\n","    print_tokens_count_and_price(response, model=model)\n","    # Запись в лог-файл\n","    add_log_file(f'\\n{messages}\\n{response.choices[0].message.content}\\n\\n\\n', title='generate_answer()')\n","    return response.choices[0].message.content\n","\n","\n","# Чтение PDF файла\n","def read_pdf(pdf_file):\n","    reader = PdfReader(pdf_file)\n","    # возвращаем текст построчно\n","    return ' '.join([line.extract_text() for line in reader.pages])\n","\n","\n","def yandex_tts(text,\n","               speaking_rate=1,\n","               voice_female=True,\n","               api_key=api_key_yandex,\n","               folder_id=folder_id_yandex):\n","    voice = \"jane\" if voice_female else \"madirus\"\n","    # URL для синтеза речи через Yandex Speech API\n","    url = 'https://tts.api.cloud.yandex.net/speech/v1/tts:synthesize'\n","    # Заголовки для авторизации с использованием API-токена\n","    headers = {\"Authorization\": f\"Api-Key {api_key}\"}\n","    # Параметры запроса для синтеза речи\n","    data = {\n","        'text': text,\n","        'lang': 'ru-RU',\n","        'voice': voice,\n","        'folderId': folder_id,\n","        'format': 'lpcm',\n","        'sampleRateHertz': 48000,\n","        'emotion': \"good\",\n","        'speed': speaking_rate\n","    }\n","    response = requests.post(url, headers=headers, data=data)\n","    if response.status_code != 200:\n","        raise RuntimeError(f\"Ошибка синтеза речи: {response.status_code}, {response.text}\")\n","    # Получаем аудио из ответа\n","    raw_audio = BytesIO(response.content)\n","    # Путь для сохранения файла\n","    output_file = os.path.join(path_audio, \"audio.mp3\")\n","    # Преобразуем аудио и сохраняем в MP3\n","    audio = AudioSegment.from_file(raw_audio, format=\"raw\", frame_rate=48000, channels=1, sample_width=2)\n","    audio.export(output_file, format=\"mp3\")\n","    return output_file\n","\n","\n","# Формируем поля для парсига Вакансии для последующего использовании при поиске\n","# https://python.langchain.com/v0.1/docs/modules/model_io/output_parsers/types/json/\n","\"\"\"Класс Vacancy с использованием библиотеки Pydantic, который будет использоваться для парсинга\n","   вакансий. Класс имеет четыре поля: position, skills, requirements и responsibilities. Описание\n","   для каждого поля включает инструкцию по извлечению соответствующих данных из текста вакансии.\"\"\"\n","add_prompt = \"Иначе, выведи ответ: None\"\n","class Vacancy(BaseModel):\n","    position: str = Field(\n","        description = f'Найди в тексте вакансии название должности (позиции). {add_prompt}')\n","    skills: str = Field(\n","        description = re.sub(r'\\s+', ' ', f\"\"\"Найди в тексте вакансии все указанные навыки.\n","                      {add_prompt}\"\"\"))\n","    requirements: str = Field(\n","        description = re.sub(r'\\s+', ' ', f\"\"\"Найди в тексте вакансии все указанные требования.\n","                      {add_prompt}\"\"\"))\n","    responsibilities: str = Field(\n","        description = re.sub(r'\\s+', ' ', f\"\"\"Найди в тексте вакансии все указанные обязанности.\n","                      {add_prompt}\"\"\"))\n","\n","\n","# Формируем поля для парсига Резюме для последующего использовании при поиске\n","# https://python.langchain.com/v0.1/docs/modules/model_io/output_parsers/types/json/\n","\"\"\"Класс Resume с использованием библиотеки Pydantic, который будет использоваться для парсинга\n","   резюме. Класс имеет три поля: position, skills и experience. Описание для каждого поля включает\n","   инструкцию по извлечению соответствующих данных из текста вакансии.\"\"\"\n","add_prompt = \"Иначе, выведи ответ: None\"\n","class Resume(BaseModel):\n","    position: str = Field(\n","        description = f'Найди в тексте резюме название должности (позиции). {add_prompt}')\n","    skills: str = Field(\n","        description = re.sub(r'\\s+', ' ', f\"\"\"Найди в тексте резюме все указанные навыки (стек).\n","                      {add_prompt}\"\"\"))\n","    experience: str = Field(\n","        description = re.sub(r'\\s+', ' ', f\"\"\"Найди в тексте резюме описание прошлого опыта с\n","                      описанием деятельности. {add_prompt}\"\"\"))\n","\n","\n","# Парсинг текста с формированием полей по параметрам (parser_class=Vacancy или Resume)\n","# JSON parser https://python.langchain.com/v0.1/docs/modules/model_io/output_parsers/types/json/\n","def to_dict_parser(text, parser_class, model='gpt-4o') -> dict:\n","    # text: текст для парсинга\n","    # parser_class: класс парсера (например, Vacancy или Resume)\n","    # model: имя модели для генерации текста (по умолчанию 'gpt-4o')\n","\n","    # Экземпляр JsonOutputParser (из langchain)\n","    parser = JsonOutputParser(pydantic_object=parser_class)\n","    prompt = PromptTemplate(\n","        input_variables = [\"query\"],\n","        # шаблон с инструкциями\n","        template = \"Follow the instructions:\\n\"\n","                   \"{format_instructions}\\n\"\n","                   \"{query}\\n\",\n","        # встроенные инструкции JsonOutputParser по форматированию\n","        partial_variables = {\"format_instructions\": parser.get_format_instructions()})\n","\n","    # цепочка (chain) из шаблона, модели и парсера\n","    # оператор '|' означает последовательное выполнение: шаблон -> модель -> парсер\n","    model = ChatOpenAI(openai_api_key=model_config[\"apiKey\"],\n","    openai_api_base=model_config[\"apiBase\"])\n","    chain = prompt | model | parser\n","    return chain.invoke({\"query\": text})\n","\n","\n","# Парсинг PDF файлов Вакансий и подготовка чанков для векторизации\n","# Cохранение данных вакансий в Json для удобства последующего использования\n","def pdf_to_json_and_chunks_vacancies(path_vacancies_pdf, model='gpt-4o-mini'):\n","    chunks_vacancies = [] # список для хранения чанков\n","    for file in os.listdir(path_vacancies_pdf): # Перебираем все файлы в указанной директории\n","        if file.endswith('.pdf'): # является ли файл PDF\n","            # From PDF to text\n","            vacancy = read_pdf(os.path.join(path_vacancies_pdf, file))\n","            add_log_file(vacancy, title='vacancy')\n","            # Парсинг текста вакансии и преобразование его в словарь с использованием заданного парсера и модели\n","            dict_vacancy = to_dict_parser(vacancy, parser_class=Vacancy, model=model)\n","            add_log_file(dict_vacancy, title='vacancy_to_dict_parser')\n","\n","            vacancy_id = file.split('.')[0] # Имя файла без расширения .pdf\n","            # записываем в словарь дополнительные поля\n","            dict_vacancy['id'] = vacancy_id\n","            dict_vacancy['vacancy'] = vacancy # в т.ч. Вакансию целиком в словарь\n","\n","            # Сохрание всех данных словаря в Json файл\n","            with open(os.path.join(path_vacancies_json, f'{vacancy_id}.json'), 'w', encoding='utf-8') as f:\n","                json.dump(dict_vacancy, f, ensure_ascii=False)\n","\n","            # Формирование чанка для векторной базы вакансий\n","            chunk = re.sub(r'\\s+', ' ',\n","                        f\"\"\"1.Позиция: {dict_vacancy.get('position', '')}.\n","                            2.Навыки: {dict_vacancy.get('skills', '')}.\n","                            3.Требования: {dict_vacancy.get('requirements', '')}.\n","                            4.Обязанности: {dict_vacancy.get('responsibilities', '')}.\"\"\")\n","            # Добавляем чанк каждой вакансии в список в формате Langchain Document\n","            chunks_vacancies.append(Document(page_content=chunk,\n","                                    metadata={\"meta\": f\"{vacancy_id}\"}))\n","    add_log_file(chunks_vacancies, title='pdf_to_json_and_chunks_vacancies')\n","    return chunks_vacancies # список чанков вакансий\n","\n","\n","# Парсинг PDF файлов Резюме и подготовка чанков для векторизации\n","# Cохранение данных резюме в Json для удобства последующего использования\n","def pdf_to_json_and_chunks_resumes(path_resumes_pdf, model='gpt-4o'):\n","    chunks_resumes = [] # список для хранения чанков\n","    for file in os.listdir(path_resumes_pdf): # Перебираем все файлы в указанной директории\n","        if file.endswith('.pdf'): # является ли файл PDF\n","            # From PDF to text\n","            resume = read_pdf(os.path.join(path_resumes_pdf, file))\n","            add_log_file(resume, title='read_pdf_resume')\n","            # Парсинг текста резюме и преобразование его в словарь с использованием заданного парсера и модели\n","            dict_resume = to_dict_parser(resume, parser_class=Resume, model=model)\n","            add_log_file(dict_resume, title='resume_to_dict_parser')\n","\n","            resume_id = file.split('.')[0] # Имя файла резюме без расширения .pdf\n","            # записываем в словарь дополнительные поля\n","            dict_resume['id'] = resume_id\n","            dict_resume['resume'] = resume # в т.ч. Резюме целиком в словарь\n","\n","            # Сохрание всех данных словаря в Json файл\n","            with open(os.path.join(path_resumes_json, f'{resume_id}.json'), 'w', encoding='utf-8') as f:\n","                json.dump(dict_resume, f, ensure_ascii=False)\n","\n","            # Формирование чанка для векторной базы резюме\n","            chunk = re.sub(r'\\s+', ' ',\n","                        f\"\"\"1.Позиция: {dict_resume.get('position', '')}.\n","                            2.Навыки: {dict_resume.get('skills', '')}.\n","                            3.Опыт: {dict_resume.get('experience', '')}.\"\"\")\n","            # Добавляем чанк каждого резюме в список в формате Langchain Document\n","            chunks_resumes.append(Document(page_content=chunk,\n","                                  metadata={\"meta\": f\"{resume_id}\"}))\n","    add_log_file(chunks_resumes, title='pdf_to_json_and_chunks_resumes')\n","    return chunks_resumes # список чанков\n","\n","\n","# Поиск релевантных чанков по запросу\n","def scores_and_meta_similarity(query, db_index, k=3):\n","    # query: текст для поиска релевантой информации\n","    # db_index: векторная база данных\n","    # k: количество возвращаемых результатов (по умолчанию 3)\n","\n","    # Нахождение наиболее похожих документов на основе заданного запроса\n","    docs_and_scores = db_index.similarity_search_with_score(query, k=k)\n","    add_log_file(docs_and_scores, title='scores_and_meta_similarity')\n","    return ([doc[1] for doc in docs_and_scores],                   # List оценок (score) по результатам поиска\n","            [doc[0].metadata['meta'] for doc in docs_and_scores])  # Мeta list с именами файлов\n","\n","\n","# Загрузка фала из GoogleDisk по открытой ссылке\n","def download_from_google_disk(link, output_path):\n","    # link: открытая ссылка на файл в Google Диске\n","    # output_path: путь, куда будет сохранен загруженный файл\n","    # Идентификатор файла - это последовательность из 25 или более символов (букв, цифр, подчеркиваний, дефисов)\n","    id = re.findall(r'/d/([a-zA-Z0-9_-]{25,})', link)  # Находим идентификатор файла в ссылке\n","    direct_link = f'https://drive.google.com/uc?export=download&id={id[0]}'  # Формируем прямую ссылку\n","    add_log_file(direct_link, title='google_link') # Запись в лог-файл\n","    gdown.download(direct_link, output_path, quiet=True) # загрузка\n","\n","\n","# Загрузка фала из YandexDisk\n","def download_from_yandex_disk(link, output_path):\n","    # link: ссылка на файл в Yandex Диске\n","    # output_path: путь, куда будет сохранен загруженный файл\n","    # Базовый URL для получения информации о ресурсе\n","    base_url = 'https://cloud-api.yandex.net/v1/disk/public/resources?'\n","    # Формируем финальный URL для запроса информации о ресурсе\n","    final_url = base_url + urlencode(dict(public_key=link))\n","    # Делаем запрос для получения информации о ресурсе\n","    response = requests.get(final_url)\n","    resource_info = response.json()\n","    # Получаем ссылку на скачивание файла\n","    download_url = resource_info['file']\n","    # Получаем имя файла\n","    file_name = resource_info['name']\n","    # Скачиваем файл\n","    download_response = requests.get(download_url)\n","    with open(os.path.join(output_path, file_name), 'wb') as f:\n","        f.write(download_response.content)\n","    add_log_file(link, title='yandex_link') # Запись в лог-файл\n","\n","\n","# Разархивирование содержимого архива в ту же папку\n","def unrar(path):\n","    for rar in os.listdir(path): # пробегаем по всем файлам в папке\n","        if rar.endswith('.rar'): # является ли файл арховом RAR\n","            filepath = os.path.join(path, rar) # путь к RAR файлу\n","            with rarfile.RarFile(filepath) as opened_rar:\n","                opened_rar.extractall(path) # разархивирование в ту же папку\n","\n","\n","# Функция дублирования строки с символом '#...'\n","def duplicate_lines(text):\n","    lines = text.split('\\n')\n","    result = []\n","    for line in lines:\n","        if line.startswith('#'): # строка с символом '#...'\n","            result.append(line)\n","        result.append(line.lstrip('# ')) # дублируем без '#'\n","    return '\\n'.join(result)\n","\n","\n","# Создание векторной базы из текстового файла с Markdown разметкой\n","def db_from_markdown_file(markdown_file):\n","    # Открываем и читаем содержимое Markdown файла\n","    with open(markdown_file, 'r', encoding='utf-8') as f:\n","        markdown_info = f.read()\n","    markdown_info = duplicate_lines(markdown_info)\n","    # Определяем заголовки, по которым будет выполняться разбиение текста\n","    # В данном случае, это заголовки уровня 1 (#)\n","    headers_to_split_on = [(\"#\", \"Header 1\"),]\n","    # Экземпляр MarkdownHeaderTextSplitter с указанными заголовками для разбиения текста\n","    splitter = MarkdownHeaderTextSplitter(headers_to_split_on=headers_to_split_on)\n","    # Разбиваем содержимое Markdown файла на чанки на основе заголовков\n","    chunks = splitter.split_text(markdown_info)\n","    # Создаем и возвращаем векторную базу данных FAISS\n","    return FAISS.from_documents(chunks, OpenAIEmbeddings())\n","\n","\n","# Функция диалога, поочередной подачи вопросов из списка и получение ответов\n","def ask_questions(questions):\n","    responses = []\n","    for question in questions:\n","        # Озвучивание вопроса без номера\n","        display(Audio(yandex_tts(re.sub(r'^\\d+\\.', '', question))))\n","        time.sleep(1) # без паузы, после вывода Audio в Колаб иногда не появляется поле для ввода input()\n","\n","        print(format_text(f\"Рекрутер: {question}\"), '\\n')\n","        answer = input(\"Кандидат: \")\n","        formatted_answer = format_text(f\"Кандидат: {answer}\")\n","        # добаляем историю диалога в список\n","        responses.append(f\"{question}\\n\\n{formatted_answer}\\n\\n\")\n","        print('\\n')\n","    add_log_file(responses, title='ask_questions(questions)')\n","    return responses\n","\n","\n","# Функция типовых вопросов\n","def conduct_interview(resume):\n","    text_start = f'Рекрутер: Здравствуйте! Давайте начнем собеседование. План собеседования следующий: \\n 1. Я задам Вам несколько вопросов. \\n 2. Расскажу о нашей компании и имеющейся вакансии \\n 3. Отвечу на Ваши вопросы. \\n Общайтесь пожалуйста со мной как с обычным рекрутером!'\n","    # Озвучивание text_start без слова \"Рекрутер\"\n","    display(Audio(yandex_tts(text_start.replace(\"Рекрутер:\", \"\"))))\n","    time.sleep(1)\n","\n","    print(text_start, '\\n')\n","    interview_summary = [f\"Резюме:\\n{resume}\\n\", \"Интервью:\\n\"]\n","    # добаляем историю диалога в список\n","    interview_summary.extend(ask_questions(questions))\n","    add_log_file(\"\\n\".join(interview_summary), title='conduct_interview')\n","    # возвращаем резюме и историю диалога в текстовом виде (str)\n","    return \"\\n\".join(interview_summary)\n","\n","\n","# Функция анализа диалога и генерация доп. вопросов\n","def generate_dialogue(prompt_system, prompt_user, model='gpt-4o'):\n","    print(f'Рекрутер: Подождите минутку. Я проанализирую Ваши ответы и сформулирую дополнительные вопросы.', '\\n')\n","    answer = generate_answer(prompt_system, prompt_user, model=model)\n","    print(format_text(answer))\n","    return answer\n","\n","\n","# Функция дополнительных вопросов\n","def ask_additional_questions(questions):\n","    question_list = questions.split('\\n') # формируем список из строк\n","    question_list = [q for q in question_list if q.strip()] # убираем из списка пустые строки\n","    additional_responses = ask_questions(question_list) # функция диалога\n","    add_log_file(additional_responses, title='ask_additional_questions') # Запись в лог-файл\n","    return additional_responses\n","\n","\n","# Функция презентации компании\n","def present_company_and_vacancy(company_description):\n","    text_presentation = f'Рекрутер: Спасибо, что ответили на все дополнительные вопросы. Теперь я хочу подробнее рассказать Вам о нашей организации. Нажмите Enter, когда будете готовы.'\n","    print(format_text(text_presentation), '\\n')\n","    input()\n","    print(format_text(company_description), '\\n\\n')\n","\n","\n","# Функция ответа на вопросы кандидата\n","def handle_candidate_questions(candidate_position,\n","                               prompt_candidate_questions,\n","                               query_candidate_questions_template,\n","                               db_company_info,\n","                               model='gpt-4o-mini'):\n","    text_candidate_questions = f'Рекрутер: Если у Вас остались какие-либо вопросы, задайте их, пожалуйста, и я постараюсь ответить. Если вопросов нет, просто напишите \"вопросов нет\", и мы завершим наше собеседование.'\n","    print(format_text(text_candidate_questions), '\\n\\n')\n","\n","    while True:\n","        candidate_question = input(\"Кандидат: \")\n","        print()\n","        if candidate_question.strip().lower() == 'вопросов нет':\n","            print(\"Рекрутер: Спасибо за собеседование! Желаем Вам удачи!\")\n","            break\n","        candidate_question = f'Вопрос к позиции: {candidate_position}: {candidate_question}'\n","        # Полный вопрос кандидата с промптом\n","        query_candidate_questions = query_candidate_questions_template.format(candidate_question=candidate_question)\n","        # нахождение наиболее похожих документов на основе заданного вопроса кандидата\n","        docs = db_company_info.similarity_search(candidate_question, k=3) # search similarity\n","\n","        # из списока объектов базы знаний docs, извлекаем атрибуты page_content (содержание документов) из каждого docs,\n","        # добавляем заголовок с форматом '\\nChank {i+1}:\\n' и объединяем их в строку с одним пробелом между каждым элементом.\n","        message_content = re.sub(r'\\n{2}', ' ', '\\n '.join([f'\\nChank {i+1}:\\n' + \\\n","                                                      doc.page_content + '\\n' for i, doc in enumerate(docs)]))\n","\n","        query_candidate_questions = f'# База знаний для ответов: \\n{message_content} \\n# {query_candidate_questions}'\n","        # Функция генерации ответа на вопрос\n","        answer = generate_answer(prompt_candidate_questions, query_candidate_questions, model=model, temp=0.3)\n","        add_log_file(f'{query_candidate_questions}\\n{answer}', title='handle_candidate_questions')\n","\n","        # Озвучивание ответа\n","        display(Audio(yandex_tts(answer)))\n","        time.sleep(1) # без паузы, после вывода Audio в Колаб иногда не появляется поле для ввода input()\n","        print(\"Рекрутер: \" + format_text(answer))\n","        print()\n","\n","\n","# Функция генерации оценки кандидата\n","def generate_estimation(prompt_system, prompt_user, model='gpt-4o-mini'):\n","    print(\"Итоговый отчет по кандидату:\", '\\n')\n","    answer = generate_answer(prompt_system, prompt_user, model=model)\n","    print(format_text(answer))\n","    return answer"],"metadata":{"id":"DCzopIYObBgA","pycharm":{"name":"#%%\n"}},"execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["# Решение"],"metadata":{"id":"2bl3ZiJarjxG"}},{"cell_type":"code","source":["#@title\n","\n","def read_pdf(file_path):\n","    try:\n","        with pdfplumber.open(file_path) as pdf:\n","            text = ''\n","            for page in pdf.pages:\n","                text += page.extract_text() + '\\n'\n","        return text\n","    except Exception as e:\n","        print(f\"Ошибка при чтении {file_path}: {e}\")\n","        return None"],"metadata":{"id":"CSUvj-qJqpue"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["import requests\n","import io\n","\n","url_vacancy = vacancy_link\n","response = requests.head(url_vacancy, allow_redirects=True)\n","print(response.headers.get('Content-Type'))\n","\n","\n","url_resume = resume_link\n","response = requests.head(url_resume, allow_redirects=True)\n","print(response.headers.get('Content-Type'))"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"AmexIxAyRGB0","executionInfo":{"status":"ok","timestamp":1760451905906,"user_tz":-180,"elapsed":2031,"user":{"displayName":"летучая мыш нет","userId":"15606522630716566801"}},"outputId":"9f48bea1-6c37-432d-99f5-31c340363cd5"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["application/octet-stream\n","application/octet-stream\n"]}]},{"cell_type":"code","source":["# Выполняем запрос\n","response = requests.get(url_vacancy)\n","\n","# Проверяем успешность запроса\n","if response.status_code == 200:\n","    # Выводим первые 100 байт содержимого\n","    print(response.content[:100])\n","else:\n","    print(f\"Ошибка загрузки: статус {response.status_code}\")\n","\n","\n","response = requests.get(url_resume)\n","if response.status_code == 200:\n","    # Выводим первые 100 байт содержимого\n","    print(response.content[:100])\n","else:\n","    print(f\"Ошибка загрузки: статус {response.status_code}\")"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"OtyENRnnTD-N","executionInfo":{"status":"ok","timestamp":1760451908507,"user_tz":-180,"elapsed":2600,"user":{"displayName":"летучая мыш нет","userId":"15606522630716566801"}},"outputId":"64af4385-bcbc-4421-b7bd-146d4c1897b4"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["b'%PDF-1.5\\r%\\xe2\\xe3\\xcf\\xd3\\r\\n14 0 obj\\r<</Linearized 1/L 82392/O 16/E 76042/N 2/T 82077/H [ 510 223]>>\\rendobj\\r    '\n","b'%PDF-1.6\\r%\\xe2\\xe3\\xcf\\xd3\\r\\n83 0 obj\\r<</Filter/FlateDecode/First 38/Length 318/N 6/Type/ObjStm>>stream\\r\\nh\\xde\\xccS\\xd1j\\xc2@'\n"]}]},{"cell_type":"code","source":["import requests\n","import io\n","import PyPDF2\n","import pdfplumber\n","\n","# URL PDF файла\n","url_vacancy = vacancy_link\n","url_resume = resume_link\n","\n","# Выполняем запрос\n","def download_from_google_disk_vacancy(link, output_path):\n","  # Скачиваем файл в память\n","  response = requests.get(url_vacancy)\n","  response.raise_for_status()\n","  # Создаем файл-объект в памяти\n","  pdf_file = io.BytesIO(response.content)\n","\n","# Открываем PDF с помощью pdfplumber\n","  with pdfplumber.open(pdf_file) as pdf:\n","      text = ''\n","      for page in pdf.pages:\n","          text += page.extract_text() + '\\n'\n","\n","# Выводим часть текста\n","  print(text[:100])\n","def download_from_google_disk_resume(link, output_path):\n","  # Скачиваем файл в память\n","  response = requests.get(url_resume)\n","  response.raise_for_status()\n","\n","  pdf_file = io.BytesIO(response.content)\n","\n","  with pdfplumber.open(pdf_file) as pdf:\n","      text = ''\n","      for page in pdf.pages:\n","          text += page.extract_text() + '\\n'\n","      print(text[:100])"],"metadata":{"id":"ytt0yXdASbd7"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["#@title Загрузка PDF файлов вакансий и резюме\n","\n","# Загрузка PDF файлов вакансий в RAR архиве\n","rar_vacancies = vacancy_link\n","download_from_google_disk_vacancy(rar_vacancies, path_vacancies_pdf)\n","unrar(path_vacancies_pdf) # разархивирование PDF вакансий в ту же папку\n","\n","# Загрузка PDF файлов резюме в RAR архиве\n","rar_resumes = resume_link\n","download_from_google_disk_resume(rar_resumes, path_resumes_pdf)\n","unrar(path_resumes_pdf) # разархивирование PDF резюме в ту же папку"],"metadata":{"id":"u9kquwiqJsZ5","executionInfo":{"status":"ok","timestamp":1760451914101,"user_tz":-180,"elapsed":5574,"user":{"displayName":"летучая мыш нет","userId":"15606522630716566801"}},"colab":{"base_uri":"https://localhost:8080/"},"outputId":"5a8f19ec-7e0a-4af0-9109-c2ac47ef0a32"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["HRD/HR Director в AI компанию\n","от 160 000 до 250 000 ₽ до вычета налогов\n","Требуемый опыт работы: 1–3 г\n","Женщина, родилась 22 марта 1989\n","Проживает: Санкт-Петербург\n","Гражданство: Россия\n","Готова к переезду: Мо\n"]}]},{"cell_type":"code","source":["def is_pdf(file_path):\n","    with open(file_path, 'rb') as f:\n","        header = f.read(5)\n","        return header == b'%PDF-'\n","\n","file_path = \"/content/drive/MyDrive/data/hr/vacancies_pdf/vacancy.pdf\"\n","if is_pdf(file_path):\n","    print(\"Файл — PDF\")\n","else:\n","    print(\"Файл не является PDF или поврежден\")"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"6OBO2CzEaC9q","executionInfo":{"status":"ok","timestamp":1760451914213,"user_tz":-180,"elapsed":10,"user":{"displayName":"летучая мыш нет","userId":"15606522630716566801"}},"outputId":"86669543-e782-45b2-cae2-6e73af9f7bcf"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["Файл — PDF\n"]}]},{"cell_type":"code","source":["response = requests.get(url_vacancy)\n","with open('/content/drive/MyDrive/data/hr/vacancies_pdf/vacancy.pdf', 'wb') as f:\n","    f.write(response.content)\n","\n","if is_pdf('/content/drive/MyDrive/data/hr/vacancies_pdf/vacancy.pdf'):\n","    print(\"Файл успешно скачан и является PDF\")\n","else:\n","    print(\"Скачанный файл не является PDF\")"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"QC_b3WxvaHri","executionInfo":{"status":"ok","timestamp":1760451915452,"user_tz":-180,"elapsed":1238,"user":{"displayName":"летучая мыш нет","userId":"15606522630716566801"}},"outputId":"3a19a749-c14b-4133-cc3a-27d828f658ac"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["Файл успешно скачан и является PDF\n"]}]},{"cell_type":"code","source":["with open('/content/drive/MyDrive/data/hr/vacancies_pdf/vacancy.pdf', 'rb') as f:\n","    content = f.read()\n","\n","print(content[:100])  # первые 100 байт\n","print(content[-100:])  # последние 100 байт"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"l2rn_b0DaZga","executionInfo":{"status":"ok","timestamp":1760451915487,"user_tz":-180,"elapsed":23,"user":{"displayName":"летучая мыш нет","userId":"15606522630716566801"}},"outputId":"5d671a71-ee10-4d72-84a8-55579db52582"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["b'%PDF-1.5\\r%\\xe2\\xe3\\xcf\\xd3\\r\\n14 0 obj\\r<</Linearized 1/L 82392/O 16/E 76042/N 2/T 82077/H [ 510 223]>>\\rendobj\\r    '\n","b'bb\\x00\\x01&FFM.\\x06& \\xab\\x15D\\xb2\\x97\\x83\\xd9GA$c\\'\\x88\\xe4]\\x01fO\\x02\\x93\\x02@\\xf5\\xff\\x0f\\xa4\\x82\\xd50\\x82I\\x06F\\x10\\xc9\\xf4\\x1f\"\\x02\\x10`\\x00\\x15\\x87\\x07&\\r\\nendstream\\rendobj\\rstartxref\\r\\n116\\r\\n%%EOF\\r\\n'\n"]}]},{"cell_type":"code","source":["\n","import mimetypes\n","\n","mimetype, _ = mimetypes.guess_type('/content/drive/MyDrive/data/hr/vacancies_pdf/vacancy.pdf')\n","print(f\"Мимтип файла: {mimetype}\")"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"Z8_lbEQGahCi","executionInfo":{"status":"ok","timestamp":1760451915519,"user_tz":-180,"elapsed":22,"user":{"displayName":"летучая мыш нет","userId":"15606522630716566801"}},"outputId":"f43c0c90-5e6d-499c-e3f6-3a9008930bd3"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["Мимтип файла: application/pdf\n"]}]},{"cell_type":"code","source":["!pip install PyMuPDF"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"0VDGSHytavOq","executionInfo":{"status":"ok","timestamp":1760451923467,"user_tz":-180,"elapsed":7947,"user":{"displayName":"летучая мыш нет","userId":"15606522630716566801"}},"outputId":"3a648ef5-5bb7-442a-8dae-dcb5a3f0620e"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["Requirement already satisfied: PyMuPDF in /usr/local/lib/python3.12/dist-packages (1.26.5)\n"]}]},{"cell_type":"code","source":["import fitz\n","\n","try:\n","    doc = fitz.open('/content/drive/MyDrive/data/hr/vacancies_pdf/vacancy.pdf')\n","    print(\"Файл открыт успешно\")\n","except Exception as e:\n","    print(f\"Ошибка при открытии с помощью fitz: {e}\")"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"IENa0rJcapKK","executionInfo":{"status":"ok","timestamp":1760451923563,"user_tz":-180,"elapsed":93,"user":{"displayName":"летучая мыш нет","userId":"15606522630716566801"}},"outputId":"4938e54f-0fb5-481f-949e-fdf3ce3252f3"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["Файл открыт успешно\n"]}]},{"cell_type":"code","source":["import fitz\n","\n","doc = fitz.open('/content/drive/MyDrive/data/hr/vacancies_pdf/vacancy.pdf')\n","text = \"\"\n","for page in doc:\n","    text += page.get_text()\n","\n","print(text[:1000])  # вывод первых 1000 символов для проверки"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"d2k0fmIpa6mi","executionInfo":{"status":"ok","timestamp":1760451923605,"user_tz":-180,"elapsed":40,"user":{"displayName":"летучая мыш нет","userId":"15606522630716566801"}},"outputId":"1b93bff0-f6ed-47f4-944e-9cb3a7451d98"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["HRD/HR Director в AI компанию \n"," \n","от 160 000 до 250 000 ₽ до вычета налогов \n","Требуемый опыт работы: 1–3 года \n","Полная занятость, удаленная работа \n"," \n","Мы — Университет Искусственного Интеллекта: Лидер по созданию курсов по AI и \n","разработке AI проектов на заказ. \n","1. Запуск и Рост: Компания, запущенная в 2018 году, за 5 лет выросла до оборота \n","в 35 млн рублей в месяц. \n","2. Лидерство в Обучении: Мы - ведущий разработчик курсов по искусственному \n","интеллекту в России, опережаем конкурентов с огромным отрывом. \n","3. Основные Проекты: Мы разрабатываем ключевые проекты на заказ, среди \n","наших клиентов – РЖД, Ростелеком, Совкомбанк, Самолёт, Российская \n","академия наук, Wildberries и Российский Университет Дружбы Народов (РУДН). \n","4. Выход на Мировой Рынок: Активно расширяем границы, ведем переговоры по \n","продаже проектов на международных рынках, включая ОАЭ, Индию и Китай. \n","5. Фанаты Искусственного Интеллекта: Наша страсть и отдача AI не знает границ. \n","Мы постоянно ищем новые способы применения инноваций \n"]}]},{"cell_type":"code","source":["import os\n","import PyPDF2\n","from langchain.embeddings import OpenAIEmbeddings\n","from langchain.vectorstores import FAISS\n","\n","# Пути\n","path_vacancies_pdf = \"/content/drive/MyDrive/data/hr/vacancies_pdf\"\n","path_db_faiss = \"/content/drive/MyDrive/data/hr/faiss_index\"\n","\n","# Чтение PDF\n","def read_pdf(file_path):\n","    text = \"\"\n","    with open(file_path, 'rb') as f:\n","        reader = PyPDF2.PdfReader(f)\n","        for page in reader.pages:\n","            text += page.extract_text() or \"\"\n","    return text\n","\n","vacancy_path = os.path.join(path_vacancies_pdf, 'Head_of_sales.pdf')\n","vacancy_text = read_pdf(vacancy_path)\n","\n","# Загрузка FAISS с разрешением опасной десериализации\n","db_resumes = FAISS.load_local(\n","    folder_path=path_db_faiss,\n","    index_name='db_resumes',\n","    embeddings=OpenAIEmbeddings(openai_api_key=model_config[\"apiKey\"], openai_api_base = model_config[\"apiBase\"]),\n","    allow_dangerous_deserialization=True\n",")\n","\n","# Поиск\n","try:\n","    results = db_resumes.similarity_search(vacancy_text, k=5)\n","except UnicodeEncodeError:\n","    # Перекодируем и повторяем\n","    vacancy_text_utf8 = vacancy_text.encode('utf-8').decode('utf-8')\n","    results = db_resumes.similarity_search(vacancy_text_utf8, k=5)\n","\n","# Вывод результатов\n","for res in results:\n","    print(res.page_content)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"LatLsF_zfimS","executionInfo":{"status":"ok","timestamp":1760453347535,"user_tz":-180,"elapsed":1447,"user":{"displayName":"летучая мыш нет","userId":"15606522630716566801"}},"outputId":"1a7419eb-cc89-47e4-e644-a0e93799d315"},"execution_count":66,"outputs":[{"output_type":"stream","name":"stdout","text":["HRD/HR Director в AI компанию \n"," \n","от 160 000 до 250 000 ₽ до вычета налогов \n","Требуемый опыт работы: 1–3 года \n","Полная занятость, удаленная работа \n"," \n","Мы — Университет Искусственного Интеллекта: Лидер по созданию курсов по AI и \n","разработке AI проектов на заказ. \n","1. Запуск и Рост: Компания, запущенная в 2018 году, за 5 лет выросла до оборота \n","в 35 млн рублей в месяц. \n","2. Лидерство в Обучении: Мы - ведущий разработчик курсов по искусственному \n","интеллекту в России, опережаем конкурентов с огромным отрывом. \n","3. Основные Проекты: Мы разрабатываем ключевые проекты на заказ, среди \n","наших клиентов – РЖД, Ростелеком, Совкомбанк, Самолёт, Российская \n","академия наук, Wildberries и Российский Университет Дружбы Народов (РУДН). \n","4. Выход на Мировой Рынок: Активно расширяем границы, ведем переговоры по \n","продаже проектов на международных рынках, включая ОАЭ, Индию и Китай. \n","5. Фанаты Искусственного Интеллекта: Наша страсть и отдача AI не знает границ. \n","Мы постоянно ищем новые способы применения инноваций \n","для достижения \n","революционных результатов. \n","В данный момент мы ищем HRD. Сотрудника с аналитическим складом ума, \n","эмпатией и высокой личной ответственностью, который умеет доводить процесс \n","до результата. \n"," \n","Со своей стороны мы предлагаем тебе: \n"," \n"," \n","Оплата 80 000 фикс + kpi за выполнение плана. Средняя зп от 190; \n"," \n","Работа с международным рынком; \n"," \n","Прямое взаимодействие с собственником компании; \n"," \n","Отсутствие бюрократии; \n"," \n","Возможность воплощать свои идеи и влиять на рабочие процессы и \n","корпоративную культуру; \n"," \n","Сложные и амбициозные задачи, мы постоянно делаем то, что никто на рынке \n","еще не делал; \n"," \n","Работа с передовым продуктом на рынке; \n"," \n","Заряженную команду, которая постоянно стремится к развитию; \n"," \n","Полностью удаленная работа. \n"," \n","Свободный, но плотный график; \n"," \n","Оформление по договору услуг (с компенсацией налогов). \n"," \n","Мы сработаемся, если: \n"," \n"," \n","У тебя есть опыт работы руководителем отдела/HRD от 1 года (опыт \n","управления удаленными командами обязателен); \n"," \n","Опыт упр\n","авления в рекрутменте обязателен; \n"," \n","Опыт работы в IT-компаниях будет являться преимуществом; \n"," \n","Все твои действия подкреплены результатами и цифрами, а не просто \n","словами; \n"," \n","Высокий уровень самодисциплины, ответственность и продуктивность, умение \n","принимать решения и нести за них ответственность. \n"," \n","Обязанности: \n"," \n"," \n","Разработка и внедрение системы мониторинга и оценки эффективности \n","сотрудников; \n"," \n","Организация процесса адаптации новых сотрудников; \n"," \n","Отработка гипотез по повышению прибыли и масштабирование наиболее \n","эффективных из них; \n"," \n","Контроль качественного подбора персонала; \n"," \n","Удержание персонала; \n"," \n","Ведение HR аналитики; \n"," \n","Предоставление отчетов руководству; \n"," \n","Редкий найм ТОП-позиций. \n"," \n","Этапы собеседования: \n"," \n","1. Отклик; \n","2. Заполнение анкеты; \n","3. Онлайн-встреча с hr; \n","4. Встреча с собственником; \n","5. Добро пожаловать в команду! \n"," \n","Ключевые навыки \n"," \n"," \n","Автоматизация процессов управления персоналом \n"," \n","Рекрутмент \n"," \n","Обучение и развитие \n"," \n","Мотивация персонала \n"," \n","тия \n","операторов пункта выдачи заказов; \n","                  - Внедрение аналитики и HR дашбордов ( воронка найма, \n","eNPS, окупаемость, HR метрики по 13 \n","                  показателям бизнеса); \n","                  - Разработка системы оценки и развития компетенций \n","менеджеров пункта выдачи заказов; \n","                  - Изменение организационной структуры, штатного \n","расписания и численности исходя из \n","                  бизнес показателей эффективности и результативности. \n"," \n","                  Дополнительные проекты: \n","                  - Приглашенный спикер в онлайн школы для \n","предпринимателей ( темы обучения: блоки \n","                  системы управления персоналом, правила формирования \n","команды, методы оценки); \n","                  - Закрытие вакансий: директор по маркетингу, \n","руководитель отдела продаж, руководитель \n","                  категоричного отдела, бизнес аналитик, бизнес \n","ассистент, HRBP, менеджер по персоналу, \n","                  маркетолог, smm специалист, таргетолог, менеджер \n","маркет\n","       -Разработка и внедрение дистанционной системы \n","обучения. \n","                   -Управление бюджетом HR затрат: планирование, \n","реализация, контроль, анализ, повышение \n","                   эффективности. \n","                   - Анализ эффективности действующей организационной \n","структуры, штатного расписания и \n","                   функционала работников, формирование и продвижение \n","решений по внесению изменений в \n","                   организационную структуру, штатное расписание и \n","функционал работников. \n","                   -Контроль и анализ ситуации на рынке труда, в т.ч. \n","осуществление мониторинга рынка труда и \n","                   заработных плат. \n","                   -Разработка и внедрение нормативной и регламентирующей \n","документации. \n","                   -Самостоятельный подбор руководителей топ-уровня. \n","                   -Ведение всей необходимой отчетности. \n"," \n","                   В подчинении 2 менеджера по персоналу, руководитель \n","системы дистанционного обучения, 4 \n","               \n"]}]},{"cell_type":"markdown","metadata":{"id":"63ebf77f"},"source":["# Task\n","Извлечь текст из PDF-файлов \"vacancy.pdf\" и \"resume.pdf\", сформировать 10 ключевых требований к кандидату из вакансии, сравнить их с резюме и предоставить критическую оценку соответствия кандидата."]},{"cell_type":"markdown","metadata":{"id":"6b5e19c6"},"source":["## Извлечение текста из pdf вакансии\n","\n","### Subtask:\n","Загрузить PDF файл вакансии и извлечь из него текст.\n"]},{"cell_type":"markdown","metadata":{"id":"53ac1383"},"source":["**Reasoning**:\n","I need to download the vacancy PDF file using the provided link and function, then extract the text from the downloaded file using the specified read_pdf function that uses pdfplumber.\n","\n"]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"ba099af6","executionInfo":{"status":"ok","timestamp":1760452233450,"user_tz":-180,"elapsed":1408,"user":{"displayName":"летучая мыш нет","userId":"15606522630716566801"}},"outputId":"a353fe11-dcb0-4798-eb4c-ca097913bb4d"},"source":["# Загрузка PDF файла вакансии\n","download_from_google_disk_vacancy(vacancy_link, path_vacancies_pdf)\n","\n","# Определение имени файла вакансии (предполагается, что там будет только один PDF после загрузки)\n","vacancy_file_name = None\n","for file in os.listdir(path_vacancies_pdf):\n","    if file.endswith('.pdf'):\n","        vacancy_file_name = file\n","        break\n","\n","# Извлечение текста из PDF файла вакансии\n","if vacancy_file_name:\n","    vacancy_file_path = os.path.join(path_vacancies_pdf, vacancy_file_name)\n","    vacancy_text = read_pdf(vacancy_file_path)\n","    print(\"Текст вакансии успешно извлечен.\")\n","    # Опционально: вывести часть извлеченного текста для проверки\n","    print(\"\\nПервые 500 символов текста вакансии:\")\n","    print(format_text(vacancy_text[:500] + \"...\"))\n","else:\n","    print(\"PDF файл вакансии не найден.\")\n","    vacancy_text = None # Устанавливаем vacancy_text в None, если файл не найден"],"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["HRD/HR Director в AI компанию\n","от 160 000 до 250 000 ₽ до вычета налогов\n","Требуемый опыт работы: 1–3 г\n","Текст вакансии успешно извлечен.\n","\n","Первые 500 символов текста вакансии:\n","HRD/HR Director в AI компанию\n","\n","от 160 000 до 250 000 ₽ до вычета налогов\n","Требуемый опыт работы: 1–3 года\n","Полная занятость, удаленная работа\n","\n","Мы — Университет Искусственного Инт еллекта: Лидер по созданию к урсов по AI и\n","разработке AI проектов на заказ.\n","1. Запуск и Рост: Компания, зап ущенная в 2018 го ду, за 5 лет вы росла до оборота\n","в 35 млн рублей в месяц.\n","2. Лидерство в Обучении: Мы - ве дущий разработчик курсов по иск усственному\n","интеллекту в России, опережаем ко нкурентов с ог ро...\n"]}]},{"cell_type":"markdown","metadata":{"id":"46fd32f8"},"source":["## Извлечение текста из pdf вакансии (для Яндекс.Диска)\n","\n","### Subtask:\n","Загрузить PDF файл вакансии с Яндекс.Диска и извлечь из него текст."]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/","height":332},"id":"01be080b","executionInfo":{"status":"error","timestamp":1760453459220,"user_tz":-180,"elapsed":728,"user":{"displayName":"летучая мыш нет","userId":"15606522630716566801"}},"outputId":"ccf82948-de5e-4cbf-fb2c-94b308e3029c"},"source":["# Загрузка PDF файла вакансии с Яндекс.Диска\n","# Используем vacancy_link из ячейки Dk1Y7N_Mo1Tv\n","download_from_yandex_disk(vacancy_link, path_vacancies_pdf)\n","\n","# Определение имени файла вакансии (предполагается, что там будет только один PDF после загрузки)\n","vacancy_file_name_yandex = None\n","for file in os.listdir(path_vacancies_pdf):\n","    if file.endswith('.pdf'):\n","        vacancy_file_name_yandex = file\n","        break\n","\n","# Извлечение текста из PDF файла вакансии с помощью fitz\n","if vacancy_file_name_yandex:\n","    vacancy_file_path_yandex = os.path.join(path_vacancies_pdf, vacancy_file_name_yandex)\n","    try:\n","        doc = fitz.open(vacancy_file_path_yandex)\n","        vacancy_text_yandex = \"\"\n","        for page in doc:\n","            vacancy_text_yandex += page.get_text()\n","        doc.close()\n","        print(\"Текст вакансии с Яндекс.Диска успешно извлечен с помощью fitz.\")\n","        # Опционально: вывести часть извлеченного текста для проверки\n","        print(\"\\nПервые 500 символов текста вакансии с Яндекс.Диска:\")\n","        print(format_text(vacancy_text_yandex[:500] + \"...\"))\n","    except Exception as e:\n","        print(f\"Ошибка при извлечении текста из вакансии с Яндекс.Диска с помощью fitz: {e}\")\n","        vacancy_text_yandex = None\n","else:\n","    print(\"PDF файл вакансии с Яндекс.Диска не найден.\")\n","    vacancy_text_yandex = None # Устанавливаем vacancy_text_yandex в None, если файл не найден"],"execution_count":67,"outputs":[{"output_type":"error","ename":"KeyError","evalue":"'file'","traceback":["\u001b[0;31m---------------------------------------------------------------------------\u001b[0m","\u001b[0;31mKeyError\u001b[0m                                  Traceback (most recent call last)","\u001b[0;32m/tmp/ipython-input-1221354420.py\u001b[0m in \u001b[0;36m<cell line: 0>\u001b[0;34m()\u001b[0m\n\u001b[1;32m      1\u001b[0m \u001b[0;31m# Загрузка PDF файла вакансии с Яндекс.Диска\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m      2\u001b[0m \u001b[0;31m# Используем vacancy_link из ячейки Dk1Y7N_Mo1Tv\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m----> 3\u001b[0;31m \u001b[0mdownload_from_yandex_disk\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mvacancy_link\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mpath_vacancies_pdf\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m      4\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m      5\u001b[0m \u001b[0;31m# Определение имени файла вакансии (предполагается, что там будет только один PDF после загрузки)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/tmp/ipython-input-963305489.py\u001b[0m in \u001b[0;36mdownload_from_yandex_disk\u001b[0;34m(link, output_path)\u001b[0m\n\u001b[1;32m    268\u001b[0m     \u001b[0mresource_info\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mresponse\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mjson\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    269\u001b[0m     \u001b[0;31m# Получаем ссылку на скачивание файла\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 270\u001b[0;31m     \u001b[0mdownload_url\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mresource_info\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0;34m'file'\u001b[0m\u001b[0;34m]\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    271\u001b[0m     \u001b[0;31m# Получаем имя файла\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    272\u001b[0m     \u001b[0mfile_name\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mresource_info\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0;34m'name'\u001b[0m\u001b[0;34m]\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;31mKeyError\u001b[0m: 'file'"]}]},{"cell_type":"markdown","metadata":{"id":"15eb729c"},"source":["## Извлечение текста из pdf вакансии (для Яндекс.Диска)\n","\n","### Subtask:\n","Загрузить PDF файл вакансии с Яндекс.Диска и извлечь из него текст."]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"2c3c136b","executionInfo":{"status":"ok","timestamp":1760453880090,"user_tz":-180,"elapsed":2980,"user":{"displayName":"летучая мыш нет","userId":"15606522630716566801"}},"outputId":"1e0e53e9-60ba-4e6f-c971-417bf768e59d"},"source":["import os\n","import fitz # Assuming fitz is preferred for text extraction\n","\n","# Используем ссылку на вакансию с Яндекс.Диска\n","yandex_vacancy_link = vacancy_link_yandex # Используем переменную из ячейки Dk1Y7N_Mo1Tv\n","yandex_vacancy_output_path = os.path.join(path_vacancies_pdf, 'vacancy_yandex.pdf') # Сохраняем под другим именем\n","\n","# Загрузка PDF файла вакансии с Яндекс.Диска\n","try:\n","    print(f\"Downloading vacancy from Yandex Disk: {yandex_vacancy_link}\")\n","    download_from_yandex_disk(yandex_vacancy_link, path_vacancies_pdf) # Ensure this function works with the link\n","    print(f\"Vacancy downloaded successfully to: {yandex_vacancy_output_path}\")\n","\n","    # Определение имени файла вакансии после загрузки\n","    # download_from_yandex_disk function saves with original name, need to find it\n","    vacancy_file_name_yandex = None\n","    # Assuming the file name from the link is 'Lg7ZhWiutBVpXg' based on the user's link structure, but checking directory is safer\n","    # A better approach might be to modify download_from_yandex_disk to return the saved filename\n","\n","    # For now, let's assume the file is saved with its original name extracted from the link if possible,\n","    # or iterate through the directory to find the newest pdf or the one matching a pattern if the function names it predictably.\n","    # Based on the function download_from_yandex_disk, it extracts the file name from the resource info.\n","    # Let's try to replicate that to get the expected filename.\n","    import requests\n","    from urllib.parse import urlencode\n","\n","    base_url = 'https://cloud-api.yandex.net/v1/disk/public/resources?'\n","    final_url = base_url + urlencode(dict(public_key=yandex_vacancy_link))\n","    response = requests.get(final_url)\n","    resource_info = response.json()\n","    expected_vacancy_filename = resource_info.get('name')\n","\n","    if expected_vacancy_filename:\n","        yandex_vacancy_file_path = os.path.join(path_vacancies_pdf, expected_vacancy_filename)\n","        if os.path.exists(yandex_vacancy_file_path):\n","            try:\n","                doc = fitz.open(yandex_vacancy_file_path)\n","                vacancy_text_yandex = \"\"\n","                for page in doc:\n","                    vacancy_text_yandex += page.get_text()\n","                doc.close()\n","                print(\"Текст вакансии с Яндекс.Диска успешно извлечен с помощью fitz.\")\n","                print(\"\\nПервые 500 символов текста вакансии с Яндекс.Диска:\")\n","                print(format_text(vacancy_text_yandex[:500] + \"...\"))\n","            except Exception as e:\n","                print(f\"Ошибка при извлечении текста из вакансии с Яндекс.Диска с помощью fitz: {e}\")\n","                vacancy_text_yandex = None\n","        else:\n","             print(f\"Downloaded vacancy file not found at expected path: {yandex_vacancy_file_path}\")\n","             vacancy_text_yandex = None\n","    else:\n","        print(\"Could not determine expected filename from Yandex Disk link.\")\n","        vacancy_text_yandex = None\n","\n","except Exception as e:\n","    print(f\"Error downloading resume from Yandex Disk: {e}\")\n","    vacancy_text_yandex = None"],"execution_count":70,"outputs":[{"output_type":"stream","name":"stdout","text":["Downloading vacancy from Yandex Disk: https://disk.yandex.ru/i/Lg7ZhWiutBVpXg\n","Vacancy downloaded successfully to: /content/drive/MyDrive/data/hr/vacancies_pdf/vacancy_yandex.pdf\n","Текст вакансии с Яндекс.Диска успешно извлечен с помощью fitz.\n","\n","Первые 500 символов текста вакансии с Яндекс.Диска:\n","HRD/HR Director в AI компанию\n","\n","от 160 000 до 250 000 ₽ до вычета налогов\n","Требуемый опыт работы: 1–3 года\n","Полная занятость, удаленная работа\n","\n","Мы — Университет Искусственного Интеллекта: Лидер по созданию курсов по AI и\n","разработке AI проектов на заказ.\n","1. Запуск и Рост: Компания, запущенная в 2018 году, за 5 лет выросла до оборота\n","в 35 млн рублей в месяц.\n","2. Лидерство в Обучении: Мы - ведущий разработчик курсов по искусственному\n","интеллекту в России, опережаем конкурентов с огромным отры...\n"]}]},{"cell_type":"markdown","metadata":{"id":"b9b4f3d7"},"source":["## Оценка кандидата (для Яндекс.Диска)\n","\n","### Subtask:\n","Используя языковую модель, сравнить ключевые требования из вакансии с содержанием резюме и предоставить критическую оценку соответствия кандидата."]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"8d73a396","executionInfo":{"status":"ok","timestamp":1760453982121,"user_tz":-180,"elapsed":26241,"user":{"displayName":"летучая мыш нет","userId":"15606522630716566801"}},"outputId":"69d81595-f154-4814-a17c-283d24e41e0f"},"source":["system_prompt_evaluation = \"\"\"Ты - HR специалист. Твоя задача - провести критическую оценку соответствия кандидата, представленного в резюме, ключевым требованиям вакансии.\n","Проанализируй каждый пункт из списка ключевых требований и оцени, насколько опыт и навыки кандидата, описанные в резюме, соответствуют этому требованию.\n","В конце предоставь общую оценку соответствия кандидата вакансии и обоснуй ее.\"\"\"\n","\n","user_prompt_evaluation = f\"\"\"Ключевые требования к кандидату:\n","{key_requirements_yandex}\n","\n","Резюме кандидата:\n","{resume_text_yandex}\n","\n","Пожалуйста, сравни резюме с каждым требованием и предоставь оценку соответствия кандидата вакансии.\"\"\"\n","\n","candidate_evaluation_yandex = generate_answer(system_prompt_evaluation, user_prompt_evaluation, model='gpt-4o-mini')\n","\n","print(\"\\nКритическая оценка соответствия кандидата (по данным с Яндекс.Диска):\")\n","print(format_text(candidate_evaluation_yandex))"],"execution_count":73,"outputs":[{"output_type":"stream","name":"stdout","text":["Tokens used: 12705 + 2708 = 15413. *** gpt-4o-mini *** $ 0.00353\n","\n","Критическая оценка соответствия кандидата (по данным с Яндекс.Диска):\n","### Оценка соответствия кандидата ключевым требованиям вакансии\n","\n","1. **Опыт работы руководителем отдела/HRD от 1 года, включая управление удаленными командами.**\n","   - **Оценка:** Соответствует. Кандидат имеет более 12 лет опыта в HR, включая 1 год 4 месяца в частной практике и 2\n","года 11 месяцев в роли директора по персоналу, где управляла удаленными командами.\n","\n","2. **Обязательный опыт в рекрутменте.**\n","   - **Оценка:** Соответствует. Кандидат имеет значительный опыт в подборе персонала, включая массовый подбор и закрытие\n","вакансий на различные позиции.\n","\n","3. **Преимущество — опыт работы в IT-компаниях.**\n","   - **Оценка:** Соответствует. Кандидат работала в компании \"Билайн\", которая является IT-компанией, и имеет опыт в\n","управлении HR-процессами в этой сфере.\n","\n","4. **Способность подкреплять действия результатами и цифрами.**\n","   - **Оценка:** Соответствует. В резюме указаны конкретные результаты, такие как увеличение численности агентов и\n","снижение текучести кадров, что подтверждает способность кандидата работать с цифрами.\n","\n","5. **Высокий уровень самодисциплины и ответственности.**\n","   - **Оценка:** Соответствует. Кандидат демонстрирует высокий уровень ответственности в управлении HR-процессами и в\n","реализации проектов.\n","\n","6. **Умение принимать решения и нести за них ответственность.**\n","   - **Оценка:** Соответствует. Кандидат имеет опыт в принятии решений, связанных с изменением организационной структуры\n","и внедрением новых процессов.\n","\n","7. **Навыки автоматизации процессов управления персоналом.**\n","   - **Оценка:** Соответствует. Кандидат упоминает внедрение автоматизации процессов на базе Talantix и корпоративного\n","портала.\n","\n","8. **Опыт в обучении и развитии сотрудников.**\n","   - **Оценка:** Соответствует. Кандидат имеет опыт в разработке и проведении тренингов, а также в создании программ\n","развития сотрудников.\n","\n","9. **Умение организовывать процесс адаптации новых сотрудников.**\n","   - **Оценка:** Соответствует. Кандидат разработала и внедрила процессы адаптации для новых сотрудников в нескольких\n","компаниях.\n","\n","10. **Навыки ведения HR аналитики и предоставления отчетов руководству.**\n","    - **Оценка:** Соответствует. Кандидат внедрила HR-дашборды и проводила аудит HR-функции, что подтверждает наличие\n","навыков аналитики.\n","\n","### Общая оценка соответствия кандидата вакансии\n","\n","**Общая оценка:** Высокая\n","\n","**Обоснование:** Кандидат полностью соответствует всем ключевым требованиям вакансии. У нее есть значительный опыт\n","работы в HR, включая управление удаленными командами, рекрутмент, автоматизацию процессов и обучение сотрудников. Она\n","также имеет опыт работы в IT-компании и демонстрирует способность достигать результатов, подкрепленных цифрами. Кандидат\n","выглядит как сильный претендент на данную позицию.\n"]}]},{"cell_type":"markdown","metadata":{"id":"be4b6a7b"},"source":["## Формирование ключевых требований (для Яндекс.Диска)\n","\n","### Subtask:\n","Используя извлеченный текст вакансии с Яндекс.Диска и языковую модель, сформировать список из 10 ключевых требований к кандидату."]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"6ea3503a","executionInfo":{"status":"ok","timestamp":1760453942174,"user_tz":-180,"elapsed":5109,"user":{"displayName":"летучая мыш нет","userId":"15606522630716566801"}},"outputId":"41e87e22-cacf-4dd0-f1b8-26969d6e1293"},"source":["system_prompt = \"\"\"Ты - HR специалист. Твоя задача - внимательно прочитать текст вакансии и выделить ТОП-10 ключевых требований к кандидату. Сформулируй требования четко и лаконично в виде нумерованного списка.\"\"\"\n","\n","user_prompt = f\"\"\"Вот текст вакансии:\n","{vacancy_text_yandex}\n","\n","Пожалуйста, выдели 10 ключевых требований к кандидату из этого текста.\"\"\"\n","\n","key_requirements_yandex = generate_answer(system_prompt, user_prompt, model='gpt-4o-mini')\n","\n","print(\"\\nКлючевые требования к кандидату (из вакансии с Яндекс.Диска):\")\n","print(format_text(key_requirements_yandex))"],"execution_count":72,"outputs":[{"output_type":"stream","name":"stdout","text":["Tokens used: 3668 + 578 = 4246. *** gpt-4o-mini *** $ 0.0009\n","\n","Ключевые требования к кандидату (из вакансии с Яндекс.Диска):\n","1. Опыт работы руководителем отдела/HRD от 1 года, включая управление удаленными командами.\n","2. Обязательный опыт в рекрутменте.\n","3. Преимущество — опыт работы в IT-компаниях.\n","4. Способность подкреплять действия результатами и цифрами.\n","5. Высокий уровень самодисциплины и ответственности.\n","6. Умение принимать решения и нести за них ответственность.\n","7. Навыки автоматизации процессов управления персоналом.\n","8. Опыт в обучении и развитии сотрудников.\n","9. Умение организовывать процесс адаптации новых сотрудников.\n","10. Навыки ведения HR аналитики и предоставления отчетов руководству.\n"]}]},{"cell_type":"markdown","metadata":{"id":"86bea415"},"source":["## Извлечение текста из pdf резюме (для Яндекс.Диска)\n","\n","### Subtask:\n","Загрузить PDF файл резюме с Яндекс.Диска и извлечь из него текст."]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"5113da5b","executionInfo":{"status":"ok","timestamp":1760453921971,"user_tz":-180,"elapsed":3830,"user":{"displayName":"летучая мыш нет","userId":"15606522630716566801"}},"outputId":"0e724fae-863e-457d-a172-470ce6ddcb53"},"source":["import os\n","import fitz\n","import requests\n","from urllib.parse import urlencode\n","\n","# Используем ссылку на резюме с Яндекс.Диска\n","yandex_resume_link = resume_link_yandex # Используем переменную из ячейки Dk1Y7N_Mo1Tv\n","yandex_resume_output_path = os.path.join(path_resumes_pdf, 'resume_yandex.pdf') # Сохраняем под другим именем\n","\n","# Загрузка PDF файла резюме с Яндекс.Диска\n","try:\n","    print(f\"Downloading resume from Yandex Disk: {yandex_resume_link}\")\n","\n","    # Replicating the logic to get the filename from the Yandex Disk resource info\n","    base_url = 'https://cloud-api.yandex.net/v1/disk/public/resources?'\n","    final_url = base_url + urlencode(dict(public_key=yandex_resume_link))\n","    response = requests.get(final_url)\n","    resource_info = response.json()\n","    expected_resume_filename = resource_info.get('name')\n","\n","    if expected_resume_filename:\n","        yandex_resume_file_path = os.path.join(path_resumes_pdf, expected_resume_filename)\n","        download_from_yandex_disk(yandex_resume_link, path_resumes_pdf) # Ensure this function works with the link\n","        print(f\"Resume downloaded successfully to: {yandex_resume_file_path}\")\n","\n","\n","        if os.path.exists(yandex_resume_file_path) and os.path.getsize(yandex_resume_file_path) > 0:\n","            try:\n","                doc = fitz.open(yandex_resume_file_path)\n","                resume_text_yandex = \"\"\n","                for page in doc:\n","                    resume_text_yandex += page.get_text()\n","                doc.close()\n","                print(\"Текст резюме с Яндекс.Диска успешно извлечен с помощью fitz.\")\n","                # Выведем часть извлеченного текста для дополнительной проверки\n","                print(\"\\nЧасть текста резюме с Яндекс.Диска:\")\n","                print(format_text(resume_text_yandex[:500] + \"...\"))\n","            except Exception as e:\n","                print(f\"Ошибка при извлечении текста из резюме с Яндекс.Диска с помощью fitz: {e}\")\n","                resume_text_yandex = None\n","        else:\n","            print(f\"Downloaded resume file not found at expected path: {yandex_resume_file_path} or is empty.\")\n","            resume_text_yandex = None\n","    else:\n","        print(\"Could not determine expected filename from Yandex Disk link.\")\n","        resume_text_yandex = None\n","\n","except Exception as e:\n","    print(f\"Error downloading resume from Yandex Disk: {e}\")\n","    resume_text_yandex = None"],"execution_count":71,"outputs":[{"output_type":"stream","name":"stdout","text":["Downloading resume from Yandex Disk: https://disk.yandex.ru/i/ULV_Onsdrx7zrw\n","Resume downloaded successfully to: /content/drive/MyDrive/data/hr/resumes_pdf/Resume HR_Director+.pdf\n","Текст резюме с Яндекс.Диска успешно извлечен с помощью fitz.\n","\n","Часть текста резюме с Яндекс.Диска:\n","Женщина, родилась 22 марта 1989\n","Проживает: Санкт-Петербург\n","Гражданство: Россия\n","Готова к переезду: Москва, готова к редким командировкам\n","Желаемая должность и зарплата\n","Директор по персоналу/ HR BP\n","Специализации:\n","—  Менеджер по персоналу\n","—  Бизнес-тренер\n","—  Специалист по подбору персонала\n","—  Директор по персоналу (HRD)\n","Занятость: полная занятость\n","График работы: полный день\n","Желательное время в пути до работы: не имеет значения\n","Опыт работы — 12 лет 9 месяцев\n","Март 2023 —\n","настоящее время\n","1 год 4 месяца...\n"]}]},{"cell_type":"markdown","metadata":{"id":"4781d2d9"},"source":["## Формирование ключевых требований\n","\n","### Subtask:\n","Используя извлеченный текст вакансии и языковую модель, сформировать список из 10 ключевых требований к кандидату.\n"]},{"cell_type":"markdown","metadata":{"id":"1e34e496"},"source":["**Reasoning**:\n","Define the system and user prompts for extracting key requirements from the vacancy text and then call the generate_answer function to get the requirements from the language model.\n","\n"]},{"cell_type":"markdown","metadata":{"id":"21218717"},"source":["**Reasoning**:\n","The previous attempt failed because the OpenAI API key was not properly configured for the `openai` client object used within the `generate_answer` function. Although the `model_config` dictionary contains the API key and base URL, the `openai.chat.completions.create` call is not using these directly. The `generate_answer` function needs to be modified to use the `client` object that was initialized with the correct `api_key` and `base_url` from `model_config`. I will redefine the `generate_answer` function to use the pre-configured `client` object and then re-run the code to generate the key requirements.\n","\n"]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"HlQ871SwIdkv","executionInfo":{"status":"ok","timestamp":1760452285860,"user_tz":-180,"elapsed":4334,"user":{"displayName":"летучая мыш нет","userId":"15606522630716566801"}},"outputId":"84947e2c-b28c-4861-fac8-5c7f387b18b2"},"source":["def generate_answer(prompt_system, prompt_user, prompt_assistant='', model='gpt-4o-mini', temp=0.1):\n","    messages = [\n","        {\"role\": \"system\", \"content\": prompt_system},\n","        {'role': 'assistant', 'content': prompt_assistant},\n","        {\"role\": \"user\", \"content\": prompt_user}\n","    ]\n","    response = client.chat.completions.create(\n","        model=model,\n","        messages=messages,\n","        temperature=temp,\n","        # max_tokens=4000\n","    )\n","    # Вывод количества используемых токенов и стоимость\n","    print_tokens_count_and_price(response, model=model)\n","    # Запись в лог-файл\n","    add_log_file(f'\\n{messages}\\n{response.choices[0].message.content}\\n\\n\\n', title='generate_answer()')\n","    return response.choices[0].message.content\n","\n","system_prompt = \"\"\"Ты - HR специалист. Твоя задача - внимательно прочитать текст вакансии и выделить ТОП-10 ключевых требований к кандидату. Сформулируй требования четко и лаконично в виде нумерованного списка.\"\"\"\n","\n","user_prompt = f\"\"\"Вот текст вакансии:\n","{vacancy_text}\n","\n","Пожалуйста, выдели 10 ключевых требований к кандидату из этого текста.\"\"\"\n","\n","key_requirements = generate_answer(system_prompt, user_prompt, model='gpt-4o-mini')\n","\n","print(\"\\nКлючевые требования к кандидату:\")\n","print(format_text(key_requirements))"],"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["Tokens used: 3644 + 519 = 4163. *** gpt-4o-mini *** $ 0.00086\n","\n","Ключевые требования к кандидату:\n","1. Опыт работы на позиции руководителя отдела HR/HRD от 1 года.\n","2. Опыт управления удаленными командами.\n","3. Обязательный опыт в рекрутменте.\n","4. Опыт работы в IT-компаниях будет преимуществом.\n","5. Способность подтверждать действия результатами и цифрами.\n","6. Высокий уровень самодисциплины и ответственности.\n","7. Умение принимать решения и нести за них ответственность.\n","8. Навыки автоматизации процессов управления персоналом.\n","9. Опыт в обучении и развитии персонала.\n","10. Аналитическое мышление и умение вести HR-аналитику.\n"]}]},{"cell_type":"markdown","metadata":{"id":"d5d6f51a"},"source":["## Извлечение текста из pdf резюме\n","\n","### Subtask:\n","Загрузить PDF файл резюме и извлечь из него текст.\n"]},{"cell_type":"markdown","metadata":{"id":"0d17117d"},"source":["**Reasoning**:\n","Load the resume PDF, extract the text, and store it in a variable.\n","\n"]},{"cell_type":"markdown","metadata":{"id":"1151c372"},"source":["**Reasoning**:\n","The previous attempt to read the PDF failed due to a PdfReadError, likely indicating a corrupted or improperly downloaded file. The `download_from_google_disk_resume` function might not be handling the direct download link correctly for this specific file. I will try a different approach to download the file using `gdown` with the direct download link format and then use `fitz` (PyMuPDF) which has shown to be more robust in previous cells to extract the text.\n","\n"]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"3nI9vTqlIq06","executionInfo":{"status":"ok","timestamp":1760452329036,"user_tz":-180,"elapsed":1687,"user":{"displayName":"летучая мыш нет","userId":"15606522630716566801"}},"outputId":"f2e9066e-0a9f-44c0-8a88-bcf942fab1d0"},"source":["import gdown\n","import fitz\n","import os\n","\n","# Construct the direct download link using gdown's format\n","# The original link is 'https://drive.google.com/uc?export=download&id=1gmYfC_W2F-fN4hYtSsqof4WyCwgLf55w'\n","# gdown can handle this format directly.\n","direct_resume_link = resume_link\n","resume_output_path = os.path.join(path_resumes_pdf, 'resume.pdf')\n","\n","# Download the resume PDF using gdown\n","try:\n","    print(f\"Downloading resume from: {direct_resume_link}\")\n","    gdown.download(direct_resume_link, resume_output_path, quiet=True)\n","    print(f\"Resume downloaded successfully to: {resume_output_path}\")\n","except Exception as e:\n","    print(f\"Error downloading resume: {e}\")\n","    resume_text = None\n","\n","# Check if the file was downloaded and try to extract text using fitz\n","if os.path.exists(resume_output_path) and os.path.getsize(resume_output_path) > 0:\n","    try:\n","        doc = fitz.open(resume_output_path)\n","        resume_text = \"\"\n","        for page in doc:\n","            resume_text += page.get_text()\n","        doc.close()\n","        print(\"Текст резюме успешно извлечен с помощью fitz.\")\n","        # Выведем часть извлеченного текста для дополнительной проверки\n","        print(\"\\nЧасть текста резюме:\")\n","        print(format_text(resume_text[:500] + \"...\"))\n","    except Exception as e:\n","        print(f\"Ошибка при извлечении текста из резюме с помощью fitz: {e}\")\n","        resume_text = None\n","else:\n","    print(\"PDF файл резюме не найден или пуст после скачивания.\")\n","    resume_text = None\n"],"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["Downloading resume from: https://drive.google.com/uc?export=download&id=1gmYfC_W2F-fN4hYtSsqof4WyCwgLf55w\n","Resume downloaded successfully to: /content/drive/MyDrive/data/hr/resumes_pdf/resume.pdf\n","Текст резюме успешно извлечен с помощью fitz.\n","\n","Часть текста резюме:\n","Женщина, родилась 22 марта 1989\n","Проживает: Санкт-Петербург\n","Гражданство: Россия\n","Готова к переезду: Москва, готова к редким командировкам\n","Желаемая должность и зарплата\n","Директор по персоналу/ HR BP\n","Специализации:\n","—  Менеджер по персоналу\n","—  Бизнес-тренер\n","—  Специалист по подбору персонала\n","—  Директор по персоналу (HRD)\n","Занятость: полная занятость\n","График работы: полный день\n","Желательное время в пути до работы: не имеет значения\n","Опыт работы — 12 лет 9 месяцев\n","Март 2023 —\n","настоящее время\n","1 год 4 месяца...\n"]}]},{"cell_type":"markdown","metadata":{"id":"290d0c1c"},"source":["## Оценка кандидата\n","\n","### Subtask:\n","Используя языковую модель, сравнить ключевые требования из вакансии с содержанием резюме и предоставить критическую оценку соответствия кандидата.\n"]},{"cell_type":"markdown","metadata":{"id":"48f35d0b"},"source":["**Reasoning**:\n","Construct the system and user prompts for the language model to evaluate the candidate based on the key requirements and the resume text, then call the `generate_answer` function and display the result.\n","\n"]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"40803112","executionInfo":{"status":"ok","timestamp":1760452371253,"user_tz":-180,"elapsed":17998,"user":{"displayName":"летучая мыш нет","userId":"15606522630716566801"}},"outputId":"196a5a23-a9aa-4c0b-b751-115597e39d85"},"source":["system_prompt_evaluation = \"\"\"Ты - HR специалист. Твоя задача - провести критическую оценку соответствия кандидата, представленного в резюме, ключевым требованиям вакансии.\n","Проанализируй каждый пункт из списка ключевых требований и оцени, насколько опыт и навыки кандидата, описанные в резюме, соответствуют этому требованию.\n","В конце предоставь общую оценку соответствия кандидата вакансии и обоснуй ее.\"\"\"\n","\n","user_prompt_evaluation = f\"\"\"Ключевые требования к кандидату:\n","{key_requirements}\n","\n","Резюме кандидата:\n","{resume_text}\n","\n","Пожалуйста, сравни резюме с каждым требованием и предоставь оценку соответствия кандидата вакансии.\"\"\"\n","\n","candidate_evaluation = generate_answer(system_prompt_evaluation, user_prompt_evaluation, model='gpt-4o-mini')\n","\n","print(\"\\nКритическая оценка соответствия кандидата:\")\n","print(format_text(candidate_evaluation))"],"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["Tokens used: 12646 + 2555 = 15201. *** gpt-4o-mini *** $ 0.00343\n","\n","Критическая оценка соответствия кандидата:\n","### Оценка соответствия кандидата ключевым требованиям вакансии\n","\n","1. **Опыт работы на позиции руководителя отдела HR/HRD от 1 года.**\n","   - Кандидат имеет более 3 лет опыта на позиции руководителя блока подбора и удержания персонала в компании \"Билайн\" и\n","более 2 лет в качестве директора по персоналу в агентстве недвижимости. Соответствие: **Да**.\n","\n","2. **Опыт управления удаленными командами.**\n","   - В резюме указано, что кандидат управлял HR-процессами в регионах и работал с удаленными сотрудниками. Соответствие:\n","**Да**.\n","\n","3. **Обязательный опыт в рекрутменте.**\n","   - Кандидат имеет значительный опыт в подборе персонала, включая массовый подбор и закрытие вакансий на различные\n","позиции. Соответствие: **Да**.\n","\n","4. **Опыт работы в IT-компаниях будет преимуществом.**\n","   - Кандидат работал в \"Билайн\", что является IT-компанией. Соответствие: **Да**.\n","\n","5. **Способность подтверждать действия результатами и цифрами.**\n","   - В резюме указаны конкретные результаты работы, такие как увеличение численности агентов и снижение текучести.\n","Соответствие: **Да**.\n","\n","6. **Высокий уровень самодисциплины и ответственности.**\n","   - Кандидат демонстрирует высокий уровень ответственности, управляя HR-процессами и командами. Соответствие: **Да**.\n","\n","7. **Умение принимать решения и нести за них ответственность.**\n","   - Кандидат принимал решения по изменению организационной структуры и внедрению новых процессов, что подразумевает\n","ответственность за результаты. Соответствие: **Да**.\n","\n","8. **Навыки автоматизации процессов управления персоналом.**\n","   - Кандидат упоминает автоматизацию процессов на базе Talantix и внедрение корпоративного портала. Соответствие:\n","**Да**.\n","\n","9. **Опыт в обучении и развитии персонала.**\n","   - Кандидат имеет опыт разработки и внедрения программ обучения и развития, а также проведения тренингов.\n","Соответствие: **Да**.\n","\n","10. **Аналитическое мышление и умение вести HR-аналитику.**\n","    - Кандидат внедрил HR-дашборды и использует метрики для анализа эффективности, что подтверждает наличие\n","аналитического мышления. Соответствие: **Да**.\n","\n","### Общая оценка соответствия кандидата вакансии\n","\n","**Общая оценка: Высокая**\n","\n","Кандидат полностью соответствует всем ключевым требованиям вакансии. У него есть значительный опыт работы в HR, включая\n","управление командами, рекрутмент, автоматизацию процессов и обучение персонала. Он также имеет опыт работы в IT-компании\n","и способен подтверждать свои достижения конкретными результатами. Кандидат демонстрирует высокую степень ответственности\n","и самодисциплины, что делает его подходящим кандидатом для данной позиции.\n"]}]},{"cell_type":"markdown","metadata":{"id":"b1fe3c45"},"source":["## Представление результатов\n","\n","### Subtask:\n","Вывести сформированные ключевые требования и результаты оценки кандидата.\n"]},{"cell_type":"markdown","metadata":{"id":"a377b35f"},"source":["**Reasoning**:\n","Print the key requirements and the candidate evaluation as requested by the instructions.\n","\n"]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"49e402d6","executionInfo":{"status":"ok","timestamp":1760452390908,"user_tz":-180,"elapsed":86,"user":{"displayName":"летучая мыш нет","userId":"15606522630716566801"}},"outputId":"6b7ef09d-7d47-441d-f2d7-2c2406b602b8"},"source":["print(\"Ключевые требования к кандидату:\")\n","print(format_text(key_requirements))\n","\n","print(\"\\nКритическая оценка соответствия кандидата:\")\n","print(format_text(candidate_evaluation))"],"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["Ключевые требования к кандидату:\n","1. Опыт работы на позиции руководителя отдела HR/HRD от 1 года.\n","2. Опыт управления удаленными командами.\n","3. Обязательный опыт в рекрутменте.\n","4. Опыт работы в IT-компаниях будет преимуществом.\n","5. Способность подтверждать действия результатами и цифрами.\n","6. Высокий уровень самодисциплины и ответственности.\n","7. Умение принимать решения и нести за них ответственность.\n","8. Навыки автоматизации процессов управления персоналом.\n","9. Опыт в обучении и развитии персонала.\n","10. Аналитическое мышление и умение вести HR-аналитику.\n","\n","Критическая оценка соответствия кандидата:\n","### Оценка соответствия кандидата ключевым требованиям вакансии\n","\n","1. **Опыт работы на позиции руководителя отдела HR/HRD от 1 года.**\n","   - Кандидат имеет более 3 лет опыта на позиции руководителя блока подбора и удержания персонала в компании \"Билайн\" и\n","более 2 лет в качестве директора по персоналу в агентстве недвижимости. Соответствие: **Да**.\n","\n","2. **Опыт управления удаленными командами.**\n","   - В резюме указано, что кандидат управлял HR-процессами в регионах и работал с удаленными сотрудниками. Соответствие:\n","**Да**.\n","\n","3. **Обязательный опыт в рекрутменте.**\n","   - Кандидат имеет значительный опыт в подборе персонала, включая массовый подбор и закрытие вакансий на различные\n","позиции. Соответствие: **Да**.\n","\n","4. **Опыт работы в IT-компаниях будет преимуществом.**\n","   - Кандидат работал в \"Билайн\", что является IT-компанией. Соответствие: **Да**.\n","\n","5. **Способность подтверждать действия результатами и цифрами.**\n","   - В резюме указаны конкретные результаты работы, такие как увеличение численности агентов и снижение текучести.\n","Соответствие: **Да**.\n","\n","6. **Высокий уровень самодисциплины и ответственности.**\n","   - Кандидат демонстрирует высокий уровень ответственности, управляя HR-процессами и командами. Соответствие: **Да**.\n","\n","7. **Умение принимать решения и нести за них ответственность.**\n","   - Кандидат принимал решения по изменению организационной структуры и внедрению новых процессов, что подразумевает\n","ответственность за результаты. Соответствие: **Да**.\n","\n","8. **Навыки автоматизации процессов управления персоналом.**\n","   - Кандидат упоминает автоматизацию процессов на базе Talantix и внедрение корпоративного портала. Соответствие:\n","**Да**.\n","\n","9. **Опыт в обучении и развитии персонала.**\n","   - Кандидат имеет опыт разработки и внедрения программ обучения и развития, а также проведения тренингов.\n","Соответствие: **Да**.\n","\n","10. **Аналитическое мышление и умение вести HR-аналитику.**\n","    - Кандидат внедрил HR-дашборды и использует метрики для анализа эффективности, что подтверждает наличие\n","аналитического мышления. Соответствие: **Да**.\n","\n","### Общая оценка соответствия кандидата вакансии\n","\n","**Общая оценка: Высокая**\n","\n","Кандидат полностью соответствует всем ключевым требованиям вакансии. У него есть значительный опыт работы в HR, включая\n","управление командами, рекрутмент, автоматизацию процессов и обучение персонала. Он также имеет опыт работы в IT-компании\n","и способен подтверждать свои достижения конкретными результатами. Кандидат демонстрирует высокую степень ответственности\n","и самодисциплины, что делает его подходящим кандидатом для данной позиции.\n"]}]},{"cell_type":"markdown","metadata":{"id":"cbd89e29"},"source":["## Summary:\n","\n","### Data Analysis Key Findings\n","\n","*   The text from both the \"vacancy.pdf\" and \"resume.pdf\" files was successfully extracted. Initial attempts to extract text from the resume PDF using `PyPDF2` failed, but this was resolved by using `gdown` for downloading and `fitz` (PyMuPDF) for extraction.\n","*   A list of 10 key requirements was successfully extracted from the vacancy text using a language model.\n","*   A language model was successfully used to compare the extracted key requirements from the vacancy with the text from the candidate's resume.\n","*   The language model provided a critical evaluation of the candidate's suitability, assessing their fit against each requirement and providing an overall assessment. The evaluation indicated a high level of suitability for the candidate based on the comparison.\n","\n","### Insights or Next Steps\n","\n","*   The process demonstrates a viable method for automating the initial screening of candidates by comparing resume content against job requirements using NLP and language models.\n","*   Future steps could involve extracting structured data (e.g., specific skills, years of experience) from both the vacancy and resume texts for a more quantitative and precise comparison, potentially reducing reliance solely on unstructured text analysis by a language model.\n"]}],"metadata":{"kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.6.13"},"colab":{"provenance":[{"file_id":"1YCvL0fi9VerygSM6SA_DQ_H6EJ-008ad","timestamp":1759573727983}]}},"nbformat":4,"nbformat_minor":0}